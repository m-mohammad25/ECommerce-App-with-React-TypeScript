import{f as S,r as l,j as e,x as I,y as b,d as f,z as k,A as v,B as F,D as H,E as L,F as g}from"./index-Bq_BoyWd.js";import{H as w}from"./style-qmAhOpjk.js";import"./style-C5DDRcX9.js";import{M as u,C as A,L as P}from"./CartItem-DbBHhHpk.js";import{B as y}from"./Button-eU2eWRp9.js";import{S as B}from"./Spinner-DopUcn5i.js";import"./Row-190GaXY8.js";import"./CloseButton-Bs2BFsBN.js";import"./useEventCallback-DstjGGbJ.js";import"./AbstractModalHeader-BaLqk6x0.js";import"./DataKey-COGXBUcQ.js";import"./Button-DpFDe-S0.js";const O="_container_1qh56_1",C={container:O};function T({products:s,userAccessToken:o}){const a=S(),[n,r]=l.useState(!1),[c,i]=l.useState(null),[m,p]=l.useState(!1),d=s.reduce((h,x)=>x.quantity&&typeof x.quantity=="number"?h+x.price*x.quantity:h,0),t=()=>{p(!m),i(null)},j=()=>{r(!0),a(I(d)).unwrap().then(()=>{a(b()),p(!1),r(!1)}).catch(h=>{i(h.message),r(!1)}).finally(()=>{r(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs(u,{show:m,onHide:t,backdrop:"static",children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx(u.Title,{children:"Placing Order"})}),e.jsxs(u.Body,{children:["Are you sure you want to place order with Subtotal:"," ",d.toFixed(2),"$",!n&&c&&e.jsx("p",{style:{color:"#DC3545",marginTop:"10px"},children:c})]}),e.jsxs(u.Footer,{children:[e.jsx(y,{variant:"secondary",onClick:t,children:"Close"}),e.jsx(y,{variant:"info",style:{color:"white"},onClick:j,children:n?e.jsxs(e.Fragment,{children:[e.jsx(B,{animation:"border",size:"sm"})," Loading..."]}):"Confirm"})]})]}),e.jsxs("div",{className:C.container,children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:[d,"$"]})]}),o&&e.jsxs("div",{className:C.container,children:[e.jsx("span",{}),e.jsx("span",{children:e.jsx(y,{variant:"info",style:{color:"white"},onClick:t,children:"Place Order"})})]})]})}function q({products:s,changeQuantityHandler:o,removeCartItem:a}){const n=s.map(r=>e.jsx(A,{...r,changeQuantityHandler:o,removeCartItem:a},r.id));return e.jsx("div",{children:n})}function E(){const s=S(),o=f(t=>t.auth.accessToken),a=f(t=>t.orders.loading),n=l.useCallback((t,j)=>{s(k({id:t,quantity:j}))},[s]),r=l.useCallback(t=>{s(v(t))},[s]),{items:c,loading:i,error:m,productsFullInfo:p}=f(t=>t.cart),d=p.map(t=>({...t,quantity:c[t.id]}));return l.useEffect(()=>{const t=s(F());return()=>{t.abort(),s(H()),s(L())}},[s]),{loading:i,error:m,products:d,changeQuantityHandler:n,userAccessToken:o,ordersLoadingStatus:a,removeCartItem:r}}function K(){const{loading:s,error:o,products:a,changeQuantityHandler:n,removeCartItem:r,ordersLoadingStatus:c,userAccessToken:i}=E();return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Cart"}),e.jsx(P,{status:s,error:o,type:"cart",children:a.length?e.jsxs(e.Fragment,{children:[e.jsx(q,{products:a,changeQuantityHandler:n,removeCartItem:r}),e.jsx(T,{products:a,userAccessToken:i})]}):c==="succeeded"?e.jsx(g,{type:"success",message:"Your order has been placed successfully!"}):e.jsx(g,{type:"emptyCart",message:"Your cart is empty"})})]})}export{K as default};
